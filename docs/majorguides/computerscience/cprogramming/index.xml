<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Unofficial UCSC Student Guide – C Programming</title><link>https://hilalmorrar.com/ucsc-guide/docs/majorguides/computerscience/cprogramming/</link><description>Recent content in C Programming on Unofficial UCSC Student Guide</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Fri, 10 Sep 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://hilalmorrar.com/ucsc-guide/docs/majorguides/computerscience/cprogramming/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: Compilation</title><link>https://hilalmorrar.com/ucsc-guide/docs/majorguides/computerscience/cprogramming/compilation/</link><pubDate>Tue, 12 Oct 2021 00:00:00 -0700</pubDate><guid>https://hilalmorrar.com/ucsc-guide/docs/majorguides/computerscience/cprogramming/compilation/</guid><description>
&lt;p>This page describes how to compile C programs that are more complex than a single source file. We&amp;rsquo;ll cover how to split code across multiple files, how to compile those files, how to automate the build process using GNU Make, and how to make use of system libraries.&lt;/p>
&lt;p>You can follow along with this guide on your own computer. All you&amp;rsquo;ll need is familiarity with the command line and a C programming environment with recent versions of Clang and Make. I would recommend using Linux (either running on your computer, in a virtual machine, or in WSL2). These commands may also work on macOS if you install Clang and Make, but they will &lt;em>not&lt;/em> work on Windows if you don&amp;rsquo;t have a Linux environment.&lt;/p>
&lt;h2 id="our-program">Our program&lt;/h2>
&lt;p>To get started, create an empty directory to hold all the files that we create. The name doesn&amp;rsquo;t matter. Navigate into that directory and create the following C file called &lt;code>hypot.c&lt;/code>. This is the program that we will be working with. Given two side lengths of a right triangle, it calculates the length of the hypotenuse.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-c" data-lang="c">&lt;span style="color:#8f5902;font-style:italic">// hypot.c
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#8f5902;font-style:italic">#include&lt;/span> &lt;span style="color:#8f5902;font-style:italic">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#8f5902;font-style:italic">
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">#include&lt;/span> &lt;span style="color:#8f5902;font-style:italic">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#8f5902;font-style:italic">
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// approximation of sqrt(x) for some values of x
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">unsigned&lt;/span> &lt;span style="color:#204a87;font-weight:bold">int&lt;/span> &lt;span style="color:#000">sqrts&lt;/span>&lt;span style="color:#000;font-weight:bold">[]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#0000cf;font-weight:bold">3&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">3&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">3&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">3&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">3&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">3&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#0000cf;font-weight:bold">4&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#0000cf;font-weight:bold">5&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">5&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">5&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">5&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">5&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">};&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">unsigned&lt;/span> &lt;span style="color:#204a87;font-weight:bold">int&lt;/span> &lt;span style="color:#000">my_sqrt&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">unsigned&lt;/span> &lt;span style="color:#204a87;font-weight:bold">int&lt;/span> &lt;span style="color:#000">x&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">x&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">25&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">fprintf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">stderr&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;error: cannot take sqrt of %u&lt;/span>&lt;span style="color:#4e9a06">\n&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">x&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#000">exit&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">sqrts&lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#000">x&lt;/span>&lt;span style="color:#000;font-weight:bold">];&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">my_hypot&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">my_sqrt&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">a&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span> &lt;span style="color:#000">a&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span> &lt;span style="color:#000">b&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">int&lt;/span> &lt;span style="color:#000">main&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">void&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000">printf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;side a: &amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">!&lt;/span>&lt;span style="color:#000">scanf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;%lf&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">))&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">fprintf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">stderr&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;invalid input&lt;/span>&lt;span style="color:#4e9a06">\n&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000">printf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;side b: &amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">!&lt;/span>&lt;span style="color:#000">scanf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;%lf&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">))&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">fprintf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">stderr&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;invalid input&lt;/span>&lt;span style="color:#4e9a06">\n&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000">printf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;c = %lf&lt;/span>&lt;span style="color:#4e9a06">\n&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">my_hypot&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">));&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>You may already know the command to compile this using Clang:&lt;/p>
&lt;pre>&lt;code>$ clang -Wall -Werror -Wextra -Wpedantic -o hypot hypot.c
&lt;/code>&lt;/pre>&lt;p>But what does every part of this mean? Clang, like most command line programs, lets you specify &lt;em>input files&lt;/em> (in this case, C files to compile) as well as &lt;em>flags&lt;/em> that modify its behavior. Each argument that isn&amp;rsquo;t part of a flag is interpreted as an input file. Let&amp;rsquo;s break down all the arguments:&lt;/p>
&lt;ul>
&lt;li>&lt;code>-Wall&lt;/code>, &lt;code>-Werror&lt;/code>, &lt;code>-Wextra&lt;/code>, &lt;code>-Wpedantic&lt;/code>: each of these enables a certain class of warnings. Together, they make Clang very strict. With these flags, compilation will often fail when issues are encountered that would normally only be treated as warnings.&lt;/li>
&lt;li>&lt;code>-o&lt;/code>, &lt;code>hypot&lt;/code>: the &lt;code>o&lt;/code> stands for &amp;ldquo;output,&amp;rdquo; and means that the next argument should be used as the output filename. This makes Clang save the executable file as &lt;code>hypot&lt;/code>, and prevents &lt;code>hypot&lt;/code> from being interpreted as an input filename.&lt;/li>
&lt;li>&lt;code>hypot.c&lt;/code>: this is the only input file.&lt;/li>
&lt;/ul>
&lt;p>The compilation should succeed without errors. Now you can run the program:&lt;/p>
&lt;pre>&lt;code>$ ./hypot
side a: 3
side b: 4
c = 5.000000
&lt;/code>&lt;/pre>&lt;p>It worked! But, as you might have noticed from the code, our calculation is extremely limited—the square root function only returns integer approximations for numbers between 0 and 25, and fails on any other numbers. Here&amp;rsquo;s an example:&lt;/p>
&lt;pre>&lt;code>$ ./hypot
side a: 2
side b: 2
c = 3.000000
&lt;/code>&lt;/pre>&lt;p>The side length should be √8 ≈ 2.828. We&amp;rsquo;re going to modify this program to:&lt;/p>
&lt;ul>
&lt;li>use the built-in math library&amp;rsquo;s &lt;code>sqrt&lt;/code> function&lt;/li>
&lt;li>move the &lt;code>my_hypot&lt;/code> function into another file&lt;/li>
&lt;li>automatically compile with all the right parameters when we run &lt;code>make&lt;/code>&lt;/li>
&lt;/ul>
&lt;h2 id="using-the-math-library">Using the math library&lt;/h2>
&lt;p>You may know that in order to call math functions like &lt;code>sqrt&lt;/code>, you need to do two things: put &lt;code>#include &amp;lt;math.h&amp;gt;&lt;/code> at the top of your file, and add &lt;code>-lm&lt;/code> to your compilation flags. What do these do?&lt;/p>
&lt;h3 id="header-files">Header files&lt;/h3>
&lt;p>Including a file with &lt;code>#include&lt;/code> inserts its contents at the position of the &lt;code>#include&lt;/code> statement, nothing more. Since &lt;code>&amp;lt;math.h&amp;gt;&lt;/code> uses angle brackets instead of quotes, the preprocessor (which is responsible for processing includes, among other things) looks for a file in the &lt;em>include path&lt;/em>, instead of the current directory. You can modify the include path, but the default (on Linux, at least) is &lt;code>/usr/include&lt;/code>. This means that we are including &lt;code>/usr/include/math.h&lt;/code>, a file that comes with the operating system. You can actually open and view this file! Sadly, it is full of macros and includes other files, so the actual declaration of &lt;code>sqrt&lt;/code> is not easy to find, but you can imagine that somewhere in that file is the declaration:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-c" data-lang="c">&lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">sqrt&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">x&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>(Since the preprocessor processes includes recursively, as far as you are concerned, that declaration may as well actually be in &lt;code>/usr/include/math.h&lt;/code>. The fact that it isn&amp;rsquo;t is transparent to you.)&lt;/p>
&lt;p>Let&amp;rsquo;s change our program to use the system&amp;rsquo;s &lt;code>sqrt&lt;/code> function (to make this tutorial easier to follow, when you modify a file, I&amp;rsquo;ll specify what the complete contents should now be):&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-c" data-lang="c">&lt;span style="color:#8f5902;font-style:italic">// hypot.c
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#8f5902;font-style:italic">#include&lt;/span> &lt;span style="color:#8f5902;font-style:italic">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#8f5902;font-style:italic">
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">#include&lt;/span> &lt;span style="color:#8f5902;font-style:italic">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#8f5902;font-style:italic">
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#8f5902;font-style:italic">// new line
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#8f5902;font-style:italic">#include&lt;/span> &lt;span style="color:#8f5902;font-style:italic">&amp;lt;math.h&amp;gt;&lt;/span>&lt;span style="color:#8f5902;font-style:italic">
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// deleted: sqrts array and my_sqrt function
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">my_hypot&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// modified
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">sqrt&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">a&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span> &lt;span style="color:#000">a&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span> &lt;span style="color:#000">b&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">int&lt;/span> &lt;span style="color:#000">main&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">void&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000">printf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;side a: &amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">!&lt;/span>&lt;span style="color:#000">scanf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;%lf&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">))&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">fprintf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">stderr&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;invalid input&lt;/span>&lt;span style="color:#4e9a06">\n&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000">printf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;side b: &amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">!&lt;/span>&lt;span style="color:#000">scanf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;%lf&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">))&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">fprintf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">stderr&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;invalid input&lt;/span>&lt;span style="color:#4e9a06">\n&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000">printf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;c = %lf&lt;/span>&lt;span style="color:#4e9a06">\n&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">my_hypot&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">));&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="linking-against-a-system-library">Linking against a system library&lt;/h3>
&lt;p>Let&amp;rsquo;s recompile:&lt;/p>
&lt;pre>&lt;code>$ clang -Wall -Wextra -Werror -Wpedantic hypot.c -o hypot
/usr/bin/ld: /tmp/hypot-1e886c.o: in function `my_hypot':
hypot.c:(.text+0x2b): undefined reference to `sqrt'
clang-12: error: linker command failed with exit code 1 (use -v to see invocation)
&lt;/code>&lt;/pre>&lt;p>Uh oh! The important part of this error is &lt;code>undefined reference to `sqrt'&lt;/code>. Remember that &lt;code>math.h&lt;/code> contains only the declaration of &lt;code>sqrt&lt;/code>. That essentially tells the compiler that there &lt;em>will be&lt;/em> a function available, called &lt;code>sqrt&lt;/code>, returning a &lt;code>double&lt;/code>, and taking one &lt;code>double&lt;/code> as its argument. However, to finish linking the binary, the linker needs to know what the address of that function will be at runtime, so that it can insert the proper function call. (We&amp;rsquo;ll get into the difference between compiling and linking later. For now, know that &lt;code>clang -Wall -Wextra -Werror -Wpedantic hypot.c -o hypot&lt;/code> runs both steps, compiling and then linking your C file).&lt;/p>
&lt;p>We can fix this error by &lt;em>linking against&lt;/em> the math library. This is a &lt;em>shared library&lt;/em>, meaning that its code can be used by any program on your computer, and the code is loaded dynamically when the program runs instead of being part of the executable. (All modern operating systems have shared libraries, but they use different file extensions. On Linux they are &lt;code>.so&lt;/code> files, macOS uses &lt;code>.dylib&lt;/code>, and Windows uses &lt;code>.dll&lt;/code>.) Each executable contains a list of shared libraries that should be loaded, and linking against a shared library just adds its name to this list.&lt;/p>
&lt;p>Library names are prefixed with &lt;code>lib&lt;/code>. The math library is &lt;code>libm&lt;/code>. To link against a library, you use &lt;code>-l&lt;/code> followed by the name of the library without the prefix, so the math library is &lt;code>-lm&lt;/code>. Let&amp;rsquo;s recompile with this flag:&lt;/p>
&lt;pre>&lt;code>$ clang -Wall -Wextra -Werror -Wpedantic hypot.c -o hypot -lm
&lt;/code>&lt;/pre>&lt;p>This time, the program handles the entire range of square roots:&lt;/p>
&lt;pre>&lt;code>$ ./hypot
side a: 2
side b: 2
c = 2.828427
&lt;/code>&lt;/pre>&lt;p>Besides the fact that compilation succeeded, how do we know that the math library was linked properly? There&amp;rsquo;s a utility called &lt;code>ldd&lt;/code> that lists which libraries a given executable links against. Let&amp;rsquo;s try it on our &lt;code>hypot&lt;/code> binary:&lt;/p>
&lt;pre>&lt;code>$ ldd hypot
linux-vdso.so.1 (0x00007ffdc0912000)
libm.so.6 =&amp;gt; /usr/lib/libm.so.6 (0x00007fa15dbbd000)
libc.so.6 =&amp;gt; /usr/lib/libc.so.6 (0x00007fa15d9f1000)
/lib64/ld-linux-x86-64.so.2 =&amp;gt; /usr/lib64/ld-linux-x86-64.so.2 (0x00007fa15dd43000)
&lt;/code>&lt;/pre>&lt;p>The exact output may differ from system to system, but you should at least see &lt;code>libm&lt;/code> and &lt;code>libc&lt;/code>. &lt;code>libc&lt;/code> is the standard C library, and it is linked by default. That&amp;rsquo;s why we can call functions like &lt;code>printf&lt;/code> and &lt;code>scanf&lt;/code> without any linker flags—they are part of &lt;code>libc&lt;/code>.&lt;/p>
&lt;p>Another interesting thing about this output is that it shows where each library is stored. On my system, they are all in &lt;code>/usr/lib&lt;/code>. I tried this on an Ubuntu system and they were in &lt;code>/lib/x86_64-linux-gnu&lt;/code> (suggesting that you could also have dynamic libraries installed for different CPU architectures). Fortunately, the system determines the exact path when your executable is running. This means I could copy my &lt;code>hypot&lt;/code> executable onto an Ubuntu system (or copy an executable compiled on Ubuntu onto my system), and it would still find all the libraries it needs.&lt;/p>
&lt;h2 id="splitting-up-our-program">Splitting up our program&lt;/h2>
&lt;p>We have successfully modified our program to use the system&amp;rsquo;s &lt;code>sqrt&lt;/code> function instead of our own janky one! All that remains is to, as promised, move the &lt;code>my_hypot&lt;/code> function into its own file.&lt;/p>
&lt;p>We&amp;rsquo;ll create two new files: a header, &lt;code>mathlib.h&lt;/code>, and a C file, &lt;code>mathlib.c&lt;/code>. Insert the following contents:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-c" data-lang="c">&lt;span style="color:#8f5902;font-style:italic">// mathlib.h
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#8f5902;font-style:italic">#pragma once
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">my_hypot&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-c" data-lang="c">&lt;span style="color:#8f5902;font-style:italic">// mathlib.c
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#8f5902;font-style:italic">#include&lt;/span> &lt;span style="color:#8f5902;font-style:italic">&amp;#34;mathlib.h&amp;#34;&lt;/span>&lt;span style="color:#8f5902;font-style:italic">
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">#include&lt;/span> &lt;span style="color:#8f5902;font-style:italic">&amp;lt;math.h&amp;gt;&lt;/span>&lt;span style="color:#8f5902;font-style:italic">
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">my_hypot&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">sqrt&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">a&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span> &lt;span style="color:#000">a&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span> &lt;span style="color:#000">b&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>The line &lt;code>#pragma once&lt;/code> in &lt;code>mathlib.h&lt;/code> ensures that the header file is only included once. It won&amp;rsquo;t make a difference in this tutorial, but in more advanced programs where one header file includes another header file (e.g. to get type definitions), you may get errors about multiple definitions of the contents of a header without &lt;code>#pragma once&lt;/code>.&lt;/p>
&lt;p>We also need to include the header file (not the C file!) from our main &lt;code>hypot.c&lt;/code>. Add the &lt;code>#include&lt;/code> statement:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-c" data-lang="c">&lt;span style="color:#8f5902;font-style:italic">// hypot.c
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#8f5902;font-style:italic">#include&lt;/span> &lt;span style="color:#8f5902;font-style:italic">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#8f5902;font-style:italic">
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">#include&lt;/span> &lt;span style="color:#8f5902;font-style:italic">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#8f5902;font-style:italic">
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">#include&lt;/span> &lt;span style="color:#8f5902;font-style:italic">&amp;lt;math.h&amp;gt;&lt;/span>&lt;span style="color:#8f5902;font-style:italic">
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#8f5902;font-style:italic">// new line
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#8f5902;font-style:italic">#include&lt;/span> &lt;span style="color:#8f5902;font-style:italic">&amp;#34;mathlib.h&amp;#34;&lt;/span>&lt;span style="color:#8f5902;font-style:italic">
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">my_hypot&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">sqrt&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">a&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span> &lt;span style="color:#000">a&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span> &lt;span style="color:#000">b&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">int&lt;/span> &lt;span style="color:#000">main&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">void&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000">printf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;side a: &amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">!&lt;/span>&lt;span style="color:#000">scanf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;%lf&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">))&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">fprintf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">stderr&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;invalid input&lt;/span>&lt;span style="color:#4e9a06">\n&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000">printf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;side b: &amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">!&lt;/span>&lt;span style="color:#000">scanf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;%lf&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">))&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">fprintf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">stderr&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;invalid input&lt;/span>&lt;span style="color:#4e9a06">\n&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000">printf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;c = %lf&lt;/span>&lt;span style="color:#4e9a06">\n&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">my_hypot&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">));&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>We &lt;code>#include&lt;/code> headers, not C files, because the C file is going to be compiled separately and linked. The file with the include statement only needs the declarations of functions, not definitions.&lt;/p>
&lt;p>You may already be thinking of some other changes we&amp;rsquo;ll have to make to &lt;code>hypot.c&lt;/code>. Let&amp;rsquo;s add &lt;code>mathlib.c&lt;/code> as an input file to our last compilation command, and try compiling this:&lt;/p>
&lt;pre>&lt;code>$ clang -Wall -Wextra -Werror -Wpedantic hypot.c mathlib.c -o hypot -lm
/usr/bin/ld: /tmp/mathlib-5b7ded.o: in function `my_hypot':
mathlib.c:(.text+0x0): multiple definition of `my_hypot'; /tmp/hypot-96432d.o:hypot.c:(.text+0x0): first defined here
clang-12: error: linker command failed with exit code 1 (use -v to see invocation)
&lt;/code>&lt;/pre>&lt;p>Zeroing in on that error, the main issue is &lt;code>multiple definition of `my_hypot'&lt;/code>. It says that one definition is in &lt;code>mathlib.c&lt;/code> and another is in &lt;code>hypot.c&lt;/code>. Let&amp;rsquo;s remove the one in &lt;code>hypot.c&lt;/code> (we also remove &lt;code>#include &amp;lt;math.h&amp;gt;&lt;/code> since this file no longer needs to call &lt;code>sqrt&lt;/code>):&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-c" data-lang="c">&lt;span style="color:#8f5902;font-style:italic">#include&lt;/span> &lt;span style="color:#8f5902;font-style:italic">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#8f5902;font-style:italic">
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">#include&lt;/span> &lt;span style="color:#8f5902;font-style:italic">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#8f5902;font-style:italic">
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">#include&lt;/span> &lt;span style="color:#8f5902;font-style:italic">&amp;#34;mathlib.h&amp;#34;&lt;/span>&lt;span style="color:#8f5902;font-style:italic">
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// my_hypot function removed
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">int&lt;/span> &lt;span style="color:#000">main&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">void&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000">printf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;side a: &amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">!&lt;/span>&lt;span style="color:#000">scanf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;%lf&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">))&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">fprintf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">stderr&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;invalid input&lt;/span>&lt;span style="color:#4e9a06">\n&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000">printf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;side b: &amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">!&lt;/span>&lt;span style="color:#000">scanf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;%lf&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&lt;/span>&lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">))&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">fprintf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">stderr&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;invalid input&lt;/span>&lt;span style="color:#4e9a06">\n&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000">printf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;c = %lf&lt;/span>&lt;span style="color:#4e9a06">\n&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">my_hypot&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">));&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>If we compile this using the same command as before, it works!&lt;/p>
&lt;h2 id="automating-compilation-with-make">Automating compilation with Make&lt;/h2>
&lt;p>We&amp;rsquo;re almost ready to reduce our entire compilation process to just one command, but first we must learn one more concept.&lt;/p>
&lt;h3 id="object-files">Object files&lt;/h3>
&lt;p>An executable file (like the &lt;code>hypot&lt;/code> file that we are creating) contains several things:&lt;/p>
&lt;ul>
&lt;li>machine code for every function in your program&lt;/li>
&lt;li>an entry point (in C, the &lt;code>main&lt;/code> function) where execution should begin&lt;/li>
&lt;li>data that the program will need when it runs (e.g. the &lt;code>&amp;quot;side a: &amp;quot;&lt;/code>) string that we print&lt;/li>
&lt;li>space for global variables&lt;/li>
&lt;li>a list of dynamic libraries that should be loaded&lt;/li>
&lt;/ul>
&lt;p>An &lt;em>object file&lt;/em> is similar to an executable, but different in some important ways. At the fundamental level, object files still contain executable code. An executable file is your whole program, but for programs with multiple source files, an object file is the compiled version of a single C file. Since object files cannot run on their own, they don&amp;rsquo;t have an entry point (they could have a function called &lt;code>main&lt;/code>, however). Also, in an executable file, every function that&amp;rsquo;s referenced must be defined either in the executable itself, or in a dynamic library that is linked. Object files can reference external functions.&lt;/p>
&lt;p>To compile a C program, you &lt;em>compile&lt;/em> each C file into an object file, and then &lt;em>link&lt;/em> those object files into one executable. Even if you don&amp;rsquo;t list these steps explicitly, Clang still performs both steps; it just deletes the object files when it&amp;rsquo;s done. The linking process entails:&lt;/p>
&lt;ul>
&lt;li>combining all the code in the various object files, making sure there are no functions with the same name&lt;/li>
&lt;li>for each function call, figuring out where that function will actually be located (in the binary or in a dynamic library) at runtime&lt;/li>
&lt;li>making sure there is a &lt;code>main&lt;/code> function, and marking it as the entry point&lt;/li>
&lt;li>producing the final binary&lt;/li>
&lt;/ul>
&lt;h3 id="manually-compiling-and-linking">Manually compiling and linking&lt;/h3>
&lt;p>First, let&amp;rsquo;s run the commands to compile our C files to object files and link them. This is what make will eventually do for us.&lt;/p>
&lt;p>The &lt;code>-c&lt;/code> flag tells Clang to output an object file instead of an executable. By default, it will just replace &lt;code>.c&lt;/code> with &lt;code>.o&lt;/code>, but you can also specify the location of the object file manually with &lt;code>-o&lt;/code>. Delete the &lt;code>hypot&lt;/code> binary if you still have it from a previous section, and then let&amp;rsquo;s compile &lt;code>hypot.c&lt;/code> and see what it creates:&lt;/p>
&lt;pre>&lt;code>$ clang -Wall -Wextra -Werror -Wpedantic -c hypot.c
$ ls
hypot.c hypot.o mathlib.c mathlib.h
&lt;/code>&lt;/pre>&lt;p>Even though &lt;code>hypot.c&lt;/code> uses functions from &lt;code>mathlib.c&lt;/code>, it compiles just fine. But let&amp;rsquo;s try linking it. The command to link object files is the same as the command to link C files, except you specify object files as input. We also omit the warning flags, since those only affect the compiler, not the linker.&lt;/p>
&lt;pre>&lt;code>$ clang hypot.o -o hypot
/usr/bin/ld: hypot.o: in function `main':
hypot.c:(.text+0xc1): undefined reference to `my_hypot'
clang-12: error: linker command failed with exit code 1 (use -v to see invocation)
&lt;/code>&lt;/pre>&lt;p>It&amp;rsquo;s complaining that it can&amp;rsquo;t find the &lt;code>my_hypot&lt;/code> function, since that is in a different file. Note that we got this error during linking and not compilation, since object files are allowed to reference functions from other files. Let&amp;rsquo;s compile &lt;code>mathlib.c&lt;/code> into an object file and try again:&lt;/p>
&lt;pre>&lt;code>$ clang -Wall -Wextra -Werror -Wpedantic -c mathlib.c
$ ls
hypot.c hypot.o mathlib.c mathlib.h mathlib.o
$ clang hypot.o mathlib.o -o hypot
/usr/bin/ld: mathlib.o: in function `my_hypot':
mathlib.c:(.text+0x2b): undefined reference to `sqrt'
clang-12: error: linker command failed with exit code 1 (use -v to see invocation)
&lt;/code>&lt;/pre>&lt;p>Now it can find &lt;code>my_hypot&lt;/code>, but it still can&amp;rsquo;t find &lt;code>sqrt&lt;/code> since we aren&amp;rsquo;t linking the math library. We can add the &lt;code>-lm&lt;/code> flag the same way as before:&lt;/p>
&lt;pre>&lt;code>$ clang -lm hypot.o mathlib.o -o hypot
$ ls
hypot hypot.c hypot.o mathlib.c mathlib.h mathlib.o
&lt;/code>&lt;/pre>&lt;p>It worked!&lt;/p>
&lt;p>Currently, after changing our code, we would have to:&lt;/p>
&lt;ul>
&lt;li>recompile any C file(s) that we changed into new object files&lt;/li>
&lt;li>link all our object files (including ones that didn&amp;rsquo;t change) into a new binary&lt;/li>
&lt;/ul>
&lt;p>This will become impractical quickly. &lt;a href="https://xkcd.com/1319/">Let&amp;rsquo;s automate it!&lt;/a>&lt;/p>
&lt;h3 id="make">Make&lt;/h3>
&lt;p>Make is a utility to automate your build process. It reads a Makefile (which is just a text file exactly called &lt;code>Makefile&lt;/code>) for instructions on how to produce various files, and builds the one that you specified.&lt;/p>
&lt;p>The true power of Make lies in its dependency system. You can specify the files that a file depends on (for instance, our binary &lt;code>hypot&lt;/code> depends on the object files &lt;code>hypot.o&lt;/code> and &lt;code>mathlib.o&lt;/code>). When you use Make to build one file, it will automatically build all the file&amp;rsquo;s dependencies. But it will also look at when the various files were modified, and avoid rebuilding dependencies that have not changed since the file that depends on them was rebuilt. In our example, this means that if we run &lt;code>make&lt;/code>, change &lt;code>hypot.c&lt;/code>, and run &lt;code>make&lt;/code> again, it won&amp;rsquo;t bother recompiling &lt;code>mathlib.c&lt;/code>. This saves a lot of time for large programs!&lt;/p>
&lt;p>We&amp;rsquo;re going to build up our Makefile a little bit at a time. Create a file called &lt;code>Makefile&lt;/code> with the following contents:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-makefile" data-lang="makefile">&lt;span style="color:#000">CC&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> clang
&lt;span style="color:#000">CFLAGS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> -Wall -Wextra -Werror -Wpedantic
&lt;span style="color:#000">LDFLAGS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> -lm
&lt;span style="color:#000">EXEC&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> hypot
&lt;span style="color:#000">OBJS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> hypot.o mathlib.o
&lt;/code>&lt;/pre>&lt;/div>&lt;p>These are variables that we&amp;rsquo;ll use later in the Makefile.&lt;/p>
&lt;ul>
&lt;li>&lt;code>CC&lt;/code> is the name of the C compiler that we use&lt;/li>
&lt;li>&lt;code>CFLAGS&lt;/code> are the flags that are passed to the compiler&lt;/li>
&lt;li>&lt;code>LDFLAGS&lt;/code> are the flags that are passed to the linker&lt;/li>
&lt;li>&lt;code>EXEC&lt;/code> is the name of the executable file we are making&lt;/li>
&lt;li>&lt;code>OBJS&lt;/code> is the list of object files that we want to compile and link&lt;/li>
&lt;/ul>
&lt;p>Let&amp;rsquo;s add the next parts to our Makefile:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-makefile" data-lang="makefile">&lt;span style="color:#000">CC&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> clang
&lt;span style="color:#000">CFLAGS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> -Wall -Wextra -Werror -Wpedantic
&lt;span style="color:#000">LDFLAGS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> -lm
&lt;span style="color:#000">EXEC&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> hypot
&lt;span style="color:#000">OBJS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> hypot.o mathlib.o
&lt;span style="color:#000">$(EXEC)&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">OBJS&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>LDFLAGS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> -o &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>EXEC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>OBJS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Make sure the last line is indented with tabs, not spaces. Make requires tabs.&lt;/p>
&lt;p>This looks complicated! The main thing going on is that &lt;code>$(VAR)&lt;/code> gets replaced with the variable &lt;code>VAR&lt;/code>. If we perform those replacements manually, those last two lines look like:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-makefile" data-lang="makefile">&lt;span style="color:#000">hypot&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">hypot&lt;/span>.&lt;span style="color:#000">o&lt;/span> &lt;span style="color:#000">mathlib&lt;/span>.&lt;span style="color:#000">o&lt;/span>
clang -lm -o hypot hypot.o mathlib.o
&lt;/code>&lt;/pre>&lt;/div>&lt;p>This is one &lt;em>target&lt;/em>. A target begins with the line &lt;code>target: dependencies&lt;/code>, so in this case we are saying that &lt;code>hypot&lt;/code> is a target which depends on &lt;code>hypot.o&lt;/code> and &lt;code>mathlib.o&lt;/code>. After this line come the command(s) to build that file, indented with tabs. You can see that, after all the variables have been substituted, the command here is the same as we were already using to link the executable.&lt;/p>
&lt;p>Let&amp;rsquo;s keep going! Next we&amp;rsquo;ll add targets to build our object files:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-makefile" data-lang="makefile">&lt;span style="color:#000">CC&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> clang
&lt;span style="color:#000">CFLAGS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> -Wall -Wextra -Werror -Wpedantic
&lt;span style="color:#000">LDFLAGS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> -lm
&lt;span style="color:#000">EXEC&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> hypot
&lt;span style="color:#000">OBJS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> hypot.o mathlib.o
&lt;span style="color:#000">$(EXEC)&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">OBJS&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>LDFLAGS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> -o &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>EXEC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>OBJS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#000">hypot.o&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">hypot&lt;/span>.&lt;span style="color:#000">c&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CFLAGS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> -c hypot.c
&lt;span style="color:#000">mathlib.o&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">mathlib&lt;/span>.&lt;span style="color:#000">c&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CFLAGS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> -c mathlib.c
&lt;/code>&lt;/pre>&lt;/div>&lt;p>We list the C files as dependencies of these targets to ensure that each object file gets rebuilt when its corresponding C file changes. But unlike the previous example, the C files will not get their own targets in the Makefile, since those files are created by us and not Make. Since Make knows it isn&amp;rsquo;t responsible for creating the C files, it will just check that each one exists before it tries to build the object file, and throw an error if one is missing.&lt;/p>
&lt;p>We&amp;rsquo;re going to add some more to the Makefile, but this is already enough to build our program! Let&amp;rsquo;s try it out. To build a Make target, just run &lt;code>make &amp;lt;target name&amp;gt;&lt;/code> in the directory containing the Makefile. If you don&amp;rsquo;t specify a target, it will use the first one that is defined. In our Makefile, that is the &lt;code>$(EXEC)&lt;/code> rule, so we are good to go. Make sure to delete your object files and executable, if you still have them from previous sections.&lt;/p>
&lt;pre>&lt;code>$ ls
hypot hypot.c hypot.o Makefile mathlib.c mathlib.h mathlib.o
$ rm hypot *.o
$ ls
hypot.c Makefile mathlib.c mathlib.h
$ make
clang -Wall -Wextra -Werror -Wpedantic -c hypot.c
clang -Wall -Wextra -Werror -Wpedantic -c mathlib.c
clang -lm -o hypot hypot.o mathlib.o
$ ls
hypot hypot.c hypot.o Makefile mathlib.c mathlib.h mathlib.o
$ ./hypot
side a: 2
side b: 3
c = 3.605551
&lt;/code>&lt;/pre>&lt;p>It worked! Note how Make prints out the commands that it runs. Let&amp;rsquo;s try compiling it again:&lt;/p>
&lt;pre>&lt;code>$ make
make: 'hypot' is up to date.
&lt;/code>&lt;/pre>&lt;p>It didn&amp;rsquo;t recompile because it has already built everything that it needs, and we didn&amp;rsquo;t change our C files.&lt;/p>
&lt;h3 id="a-more-advanced-makefile">A more advanced Makefile&lt;/h3>
&lt;p>This Makefile works fine, but it can do more. We&amp;rsquo;re going to make a few changes.&lt;/p>
&lt;h4 id="separate-all-target">Separate &lt;code>all&lt;/code> target&lt;/h4>
&lt;p>In a more advanced project, you might have multiple executable files that should be compiled. Right now, we couldn&amp;rsquo;t run &lt;code>make&lt;/code> to compile multiple executables, because it only runs the first target by default.&lt;/p>
&lt;p>We can use something called a &lt;em>phony target&lt;/em> to remedy this. A phony target is a target that doesn&amp;rsquo;t correspond to a single file. In this case, we create a target called &lt;code>all&lt;/code> with all our executables (there is still only one, but there could be more) as dependencies, and put it first in the Makefile:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-makefile" data-lang="makefile">&lt;span style="color:#000">CC&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> clang
&lt;span style="color:#000">CFLAGS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> -Wall -Wextra -Werror -Wpedantic
&lt;span style="color:#000">LDFLAGS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> -lm
&lt;span style="color:#000">EXEC&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> hypot
&lt;span style="color:#000">OBJS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> hypot.o mathlib.o
&lt;span style="color:#000">all&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">EXEC&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#000">$(EXEC)&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">OBJS&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>LDFLAGS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> -o &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>EXEC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>OBJS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#000">hypot.o&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">hypot&lt;/span>.&lt;span style="color:#000">c&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CFLAGS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> -c hypot.c
&lt;span style="color:#000">mathlib.o&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">mathlib&lt;/span>.&lt;span style="color:#000">c&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CFLAGS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> -c mathlib.c
&lt;/code>&lt;/pre>&lt;/div>&lt;p>We&amp;rsquo;ve listed &lt;code>hypot&lt;/code> as the sole dependency of the &lt;code>all&lt;/code> target. If there were a file called &lt;code>all&lt;/code> in our project, we would need to name this target something else, because Make would think that it had already been built. Note that there are no commands to build &lt;code>all&lt;/code>, because it will still run the commands to build &lt;code>hypot&lt;/code>. Feel free to try deleting the executable and/or object files and running &lt;code>make&lt;/code> again.&lt;/p>
&lt;h4 id="cleanup">Cleanup&lt;/h4>
&lt;p>It&amp;rsquo;s common to include a target called &lt;code>clean&lt;/code> that deletes all executables and object files. We&amp;rsquo;ll do this using &lt;code>rm&lt;/code> with the &lt;code>-f&lt;/code> flag (&amp;ldquo;force&amp;rdquo;). The flag means that if we ask it to delete a file that doesn&amp;rsquo;t exist, it will silently ignore that argument instead of producing an error, so we can still run our &lt;code>clean&lt;/code> target even if there isn&amp;rsquo;t anything for it to delete.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-makefile" data-lang="makefile">&lt;span style="color:#000">CC&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> clang
&lt;span style="color:#000">CFLAGS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> -Wall -Wextra -Werror -Wpedantic
&lt;span style="color:#000">LDFLAGS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> -lm
&lt;span style="color:#000">EXEC&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> hypot
&lt;span style="color:#000">OBJS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> hypot.o mathlib.o
&lt;span style="color:#000">all&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">EXEC&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#000">$(EXEC)&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">OBJS&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>LDFLAGS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> -o &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>EXEC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>OBJS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#000">hypot.o&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">hypot&lt;/span>.&lt;span style="color:#000">c&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CFLAGS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> -c hypot.c
&lt;span style="color:#000">mathlib.o&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">mathlib&lt;/span>.&lt;span style="color:#000">c&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CFLAGS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> -c mathlib.c
&lt;span style="color:#000">clean&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>
rm -f &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>EXEC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>OBJS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>clean&lt;/code> has no dependencies, and the command uses our variables to delete the files that it should. Let&amp;rsquo;s try it, first using &lt;code>make&lt;/code> to make sure our program is compiled.&lt;/p>
&lt;pre>&lt;code>$ make
make: Nothing to be done for 'all'.
$ ls
hypot hypot.c hypot.o Makefile mathlib.c mathlib.h mathlib.o
$ make clean
rm -f hypot hypot.o mathlib.o
$ ls
hypot.c Makefile mathlib.c mathlib.h
&lt;/code>&lt;/pre>&lt;h4 id="automatically-compiling-object-files">Automatically compiling object files&lt;/h4>
&lt;p>Right now, if we added another C file to our program, we&amp;rsquo;d have to add a new target to our Makefile and copy the command to compile it. This can get unwieldy, and we run the risk of introducing a subtle bug by copying the command incorrectly.&lt;/p>
&lt;p>Fortunately, Make allows us to specify much more general rules. Specifically, we can tell it how to compile any object file from the corresponding C file:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-makefile" data-lang="makefile">&lt;span style="color:#000">CC&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> clang
&lt;span style="color:#000">CFLAGS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> -Wall -Wextra -Werror -Wpedantic
&lt;span style="color:#000">LDFLAGS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> -lm
&lt;span style="color:#000">EXEC&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> hypot
&lt;span style="color:#000">OBJS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> hypot.o mathlib.o
&lt;span style="color:#000">all&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">EXEC&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#000">$(EXEC)&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">OBJS&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>LDFLAGS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> -o &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>EXEC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>OBJS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#000">%.o&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> %.&lt;span style="color:#000">c&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CFLAGS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> -c $&amp;lt;
&lt;span style="color:#000">clean&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>
rm -f &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>EXEC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>OBJS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>The syntax here is tricky. The &lt;code>%&lt;/code> symbols create a correspondence between the names of the object file and C file: any filename ending with &lt;code>.o&lt;/code> depends on the same filename but with &lt;code>.c&lt;/code> instead of &lt;code>.o&lt;/code>. In the compilation command, &lt;code>$&amp;lt;&lt;/code> gets replaced with the name of the dependency, i.e. the name of the C file.&lt;/p>
&lt;p>Let&amp;rsquo;s check that this works, using &lt;code>make clean&lt;/code> first to make sure it has to recompile everything:&lt;/p>
&lt;pre>&lt;code>$ make clean
rm -f hypot hypot.o mathlib.o
$ ls
hypot.c Makefile mathlib.c mathlib.h
$ make
clang -Wall -Wextra -Werror -Wpedantic -c hypot.c
clang -Wall -Wextra -Werror -Wpedantic -c mathlib.c
clang -lm -o hypot hypot.o mathlib.o
$ ls
hypot hypot.c hypot.o Makefile mathlib.c mathlib.h mathlib.o
&lt;/code>&lt;/pre>&lt;p>And it does!&lt;/p>
&lt;h4 id="formatting-with-clang-format">Formatting with clang-format&lt;/h4>
&lt;p>If you use &lt;a href="https://clang.llvm.org/docs/ClangFormat.html">clang-format&lt;/a> and have a configuration file (&lt;code>.clang-format&lt;/code>) next to your code, you can add a target to run it with &lt;code>make format&lt;/code> (here, the rest of the Makefile is omitted, since the target is not specific to our code):&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-makefile" data-lang="makefile">&lt;span style="color:#000">format&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>
clang-format -i -style&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>file *.&lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>ch&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="static-analysis-with-scan-build">Static analysis with scan-build&lt;/h4>
&lt;p>&lt;a href="https://clang-analyzer.llvm.org/scan-build.html">scan-build&lt;/a> is a program that detects additional problems with your code at compile time (that a compiler normally would not). We can also call it with a Makefile target:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-makefile" data-lang="makefile">&lt;span style="color:#000">scan-build&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">clean&lt;/span>
scan-build --use-cc&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> make
&lt;/code>&lt;/pre>&lt;/div>&lt;p>This target isn&amp;rsquo;t as straightforward as the clang-format one. Some details to note are:&lt;/p>
&lt;ul>
&lt;li>scan-build&amp;rsquo;s argument is the command that builds our program. Here, that is just &lt;code>make&lt;/code>.&lt;/li>
&lt;li>We list &lt;code>clean&lt;/code> as a dependency. This ensures that all object files and executables are deleted before we run scan-build, so when scan-build runs &lt;code>make&lt;/code>, the whole program is rebuilt.&lt;/li>
&lt;li>scan-build sometimes overrides the compiler used by Make. We specify &lt;code>--use-cc=$(CC)&lt;/code> (effectively &lt;code>--use-cc=clang&lt;/code>) to make sure that it will run using the same compiler that we normally use (as opposed to, say, GCC).&lt;/li>
&lt;/ul>
&lt;p>Here&amp;rsquo;s an example of running it:&lt;/p>
&lt;pre>&lt;code>$ make scan-build
rm -f hypot hypot.o mathlib.o
scan-build --use-cc=clang make
scan-build: Using '/usr/bin/clang-12' for static analysis
make[1]: warning: jobserver unavailable: using -j1. Add '+' to parent make rule.
make[1]: Entering directory '/home/ben/code/c/ucsc-guide-hypot'
/usr/bin/../lib/clang/ccc-analyzer -Wall -Wextra -Werror -Wpedantic -c hypot.c
/usr/bin/../lib/clang/ccc-analyzer -Wall -Wextra -Werror -Wpedantic -c mathlib.c
/usr/bin/../lib/clang/ccc-analyzer -lm -o hypot hypot.o mathlib.o
make[1]: Leaving directory '/home/ben/code/c/ucsc-guide-hypot'
scan-build: Analysis run complete.
scan-build: Removing directory '/tmp/scan-build-2021-10-11-005941-146456-1' because it contains no reports.
scan-build: No bugs found.
&lt;/code>&lt;/pre>&lt;h2 id="expanding-our-program">Expanding our program&lt;/h2>
&lt;p>You&amp;rsquo;ve now seen everything you need to know to use Makefiles. In this last section, I will demonstrate how the build process would change if you wanted to add more C files to your project. We&amp;rsquo;re going to add one more C file and also have our Makefile compile a second binary in addition to &lt;code>hypot&lt;/code>.&lt;/p>
&lt;p>In the spirit of CSE 13S assignment 2, we&amp;rsquo;ll build a test harness that compares the results of our &lt;code>my_hypot&lt;/code> function with the standard library&amp;rsquo;s &lt;code>hypot&lt;/code>. The results should be identical, since we&amp;rsquo;re also using the standard library&amp;rsquo;s &lt;code>sqrt&lt;/code> function and the calculation for what to take the square root of is trivial, but doing this will let us expand on our program.&lt;/p>
&lt;p>Here&amp;rsquo;s the code for the test harness. Save it in &lt;code>hypot-test.c&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-c" data-lang="c">&lt;span style="color:#8f5902;font-style:italic">// hypot-test.c
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#8f5902;font-style:italic">#include&lt;/span> &lt;span style="color:#8f5902;font-style:italic">&amp;lt;math.h&amp;gt;&lt;/span>&lt;span style="color:#8f5902;font-style:italic">
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">#include&lt;/span> &lt;span style="color:#8f5902;font-style:italic">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#8f5902;font-style:italic">
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">#include&lt;/span> &lt;span style="color:#8f5902;font-style:italic">&amp;#34;mathlib.h&amp;#34;&lt;/span>&lt;span style="color:#8f5902;font-style:italic">
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">int&lt;/span> &lt;span style="color:#000">main&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">void&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">for&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">a&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1.0&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span> &lt;span style="color:#000">a&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;=&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4.0&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span> &lt;span style="color:#000">a&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">+=&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1.0&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">for&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">b&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1.0&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span> &lt;span style="color:#000">b&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;=&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4.0&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span> &lt;span style="color:#000">b&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">+=&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1.0&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">double&lt;/span> &lt;span style="color:#000">hypot_result&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">hypot&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span> &lt;span style="color:#000">my_hypot_result&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">my_hypot&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000">difference&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">fabs&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">hypot_result&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">-&lt;/span> &lt;span style="color:#000">my_hypot_result&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#000">printf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;a = %.0f, b = %.0f: hypot = %16.15lf, my_hypot = %16.15lf, diff &amp;#34;&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;= %16.15lf&lt;/span>&lt;span style="color:#4e9a06">\n&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">a&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">hypot_result&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">my_hypot_result&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">difference&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>We can compile it manually, making sure to link against the math library and our own &lt;code>mathlib.o&lt;/code> (run &lt;code>make&lt;/code> again if you don&amp;rsquo;t have the object file):&lt;/p>
&lt;pre>&lt;code>$ clang -Wall -Werror -Wextra -Wpedantic -c hypot-test.c
$ clang -lm -o hypot-test hypot-test.o mathlib.o
$ ./hypot-test
a = 1, b = 1: hypot = 1.414213562373095, my_hypot = 1.414213562373095, diff = 0.000000000000000
a = 1, b = 2: hypot = 2.236067977499790, my_hypot = 2.236067977499790, diff = 0.000000000000000
a = 1, b = 3: hypot = 3.162277660168380, my_hypot = 3.162277660168380, diff = 0.000000000000000
a = 1, b = 4: hypot = 4.123105625617661, my_hypot = 4.123105625617661, diff = 0.000000000000000
a = 2, b = 1: hypot = 2.236067977499790, my_hypot = 2.236067977499790, diff = 0.000000000000000
a = 2, b = 2: hypot = 2.828427124746190, my_hypot = 2.828427124746190, diff = 0.000000000000000
a = 2, b = 3: hypot = 3.605551275463989, my_hypot = 3.605551275463989, diff = 0.000000000000000
a = 2, b = 4: hypot = 4.472135954999580, my_hypot = 4.472135954999580, diff = 0.000000000000000
a = 3, b = 1: hypot = 3.162277660168380, my_hypot = 3.162277660168380, diff = 0.000000000000000
a = 3, b = 2: hypot = 3.605551275463989, my_hypot = 3.605551275463989, diff = 0.000000000000000
a = 3, b = 3: hypot = 4.242640687119285, my_hypot = 4.242640687119285, diff = 0.000000000000000
a = 3, b = 4: hypot = 5.000000000000000, my_hypot = 5.000000000000000, diff = 0.000000000000000
a = 4, b = 1: hypot = 4.123105625617661, my_hypot = 4.123105625617661, diff = 0.000000000000000
a = 4, b = 2: hypot = 4.472135954999580, my_hypot = 4.472135954999580, diff = 0.000000000000000
a = 4, b = 3: hypot = 5.000000000000000, my_hypot = 5.000000000000000, diff = 0.000000000000000
a = 4, b = 4: hypot = 5.656854249492381, my_hypot = 5.656854249492381, diff = 0.000000000000000
&lt;/code>&lt;/pre>&lt;p>Next, let&amp;rsquo;s modify our Makefile to automatically build &lt;code>hypot-test&lt;/code>. First, we&amp;rsquo;ll rename the existing &lt;code>OBJS&lt;/code> to &lt;code>HYPOT_OBJS&lt;/code>, since we&amp;rsquo;ll eventually create a new list of object files that are needed for &lt;code>hypot-test&lt;/code>. We&amp;rsquo;ll also remove the &lt;code>EXEC&lt;/code> variable and instead write &lt;code>hypot&lt;/code> directly:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-makefile" data-lang="makefile">&lt;span style="color:#000">CC&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> clang
&lt;span style="color:#000">CFLAGS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> -Wall -Wextra -Werror -Wpedantic
&lt;span style="color:#000">LDFLAGS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> -lm
&lt;span style="color:#000">HYPOT_OBJS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> hypot.o mathlib.o
&lt;span style="color:#000">all&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">hypot&lt;/span>
&lt;span style="color:#000">hypot&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">HYPOT_OBJS&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>LDFLAGS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> -o hypot &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>HYPOT_OBJS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#000">%.o&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> %.&lt;span style="color:#000">c&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CFLAGS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> -c $&amp;lt;
&lt;span style="color:#000">clean&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>
rm -f hypot &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>HYPOT_OBJS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#000">format&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>
clang-format -i -style&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>file *.&lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>ch&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;span style="color:#000">scan-build&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">clean&lt;/span>
scan-build --use-cc&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> make
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now we can add &lt;code>HYPOT_TEST_OBJS&lt;/code> with the object files that this program needs, as well as a &lt;code>hypot-test&lt;/code> target. We&amp;rsquo;ll also add &lt;code>hypot-test&lt;/code> as a dependency of the &lt;code>all&lt;/code> target, so that running &lt;code>make&lt;/code> with no arguments builds both &lt;code>hypot&lt;/code> and &lt;code>hypot-test&lt;/code>. And finally, we&amp;rsquo;ll add the executable and object files to our &lt;code>clean&lt;/code> target:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-makefile" data-lang="makefile">&lt;span style="color:#000">CC&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> clang
&lt;span style="color:#000">CFLAGS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> -Wall -Wextra -Werror -Wpedantic
&lt;span style="color:#000">LDFLAGS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> -lm
&lt;span style="color:#000">HYPOT_OBJS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> hypot.o mathlib.o
&lt;span style="color:#000">HYPOT_TEST_OBJS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> hypot-test.o mathlib.o
&lt;span style="color:#000">all&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">hypot&lt;/span> &lt;span style="color:#000">hypot&lt;/span>-&lt;span style="color:#000">test&lt;/span>
&lt;span style="color:#000">hypot&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">HYPOT_OBJS&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>LDFLAGS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> -o hypot &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>HYPOT_OBJS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#000">hypot-test&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">HYPOT_TEST_OBJS&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>LDFLAGS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> -o hypot-test &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>HYPOT_TEST_OBJS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#000">%.o&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> %.&lt;span style="color:#000">c&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CFLAGS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> -c $&amp;lt;
&lt;span style="color:#000">clean&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>
rm -f hypot hypot-test &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>HYPOT_OBJS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>HYPOT_TEST_OBJS&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#000">format&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>
clang-format -i -style&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>file *.&lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>ch&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;span style="color:#000">scan-build&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">clean&lt;/span>
scan-build --use-cc&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>CC&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> make
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Let&amp;rsquo;s test this out by running &lt;code>make clean&lt;/code> and then having it recompile everything with &lt;code>make&lt;/code>:&lt;/p>
&lt;pre>&lt;code>$ ls
hypot hypot.o hypot-test.c Makefile mathlib.h
hypot.c hypot-test hypot-test.o mathlib.c mathlib.o
$ make clean
rm -f hypot hypot-test hypot.o mathlib.o hypot-test.o mathlib.o
$ ls
hypot.c hypot-test.c Makefile mathlib.c mathlib.h
$ make
clang -Wall -Wextra -Werror -Wpedantic -c hypot.c
clang -Wall -Wextra -Werror -Wpedantic -c mathlib.c
clang -Wall -Wextra -Werror -Wpedantic -c hypot-test.c
clang -lm -o hypot hypot.o mathlib.o
clang -lm -o hypot-test hypot-test.o mathlib.o
$ ls
hypot hypot.o hypot-test.c Makefile mathlib.h
hypot.c hypot-test hypot-test.o mathlib.c mathlib.o
$ ./hypot
side a: 3
side b: 4
c = 5.000000
$ ./hypot-test
a = 1, b = 1: hypot = 1.414213562373095, my_hypot = 1.414213562373095, diff = 0.000000000000000
a = 1, b = 2: hypot = 2.236067977499790, my_hypot = 2.236067977499790, diff = 0.000000000000000
a = 1, b = 3: hypot = 3.162277660168380, my_hypot = 3.162277660168380, diff = 0.000000000000000
a = 1, b = 4: hypot = 4.123105625617661, my_hypot = 4.123105625617661, diff = 0.000000000000000
a = 2, b = 1: hypot = 2.236067977499790, my_hypot = 2.236067977499790, diff = 0.000000000000000
a = 2, b = 2: hypot = 2.828427124746190, my_hypot = 2.828427124746190, diff = 0.000000000000000
a = 2, b = 3: hypot = 3.605551275463989, my_hypot = 3.605551275463989, diff = 0.000000000000000
a = 2, b = 4: hypot = 4.472135954999580, my_hypot = 4.472135954999580, diff = 0.000000000000000
a = 3, b = 1: hypot = 3.162277660168380, my_hypot = 3.162277660168380, diff = 0.000000000000000
a = 3, b = 2: hypot = 3.605551275463989, my_hypot = 3.605551275463989, diff = 0.000000000000000
a = 3, b = 3: hypot = 4.242640687119285, my_hypot = 4.242640687119285, diff = 0.000000000000000
a = 3, b = 4: hypot = 5.000000000000000, my_hypot = 5.000000000000000, diff = 0.000000000000000
a = 4, b = 1: hypot = 4.123105625617661, my_hypot = 4.123105625617661, diff = 0.000000000000000
a = 4, b = 2: hypot = 4.472135954999580, my_hypot = 4.472135954999580, diff = 0.000000000000000
a = 4, b = 3: hypot = 5.000000000000000, my_hypot = 5.000000000000000, diff = 0.000000000000000
a = 4, b = 4: hypot = 5.656854249492381, my_hypot = 5.656854249492381, diff = 0.000000000000000
&lt;/code>&lt;/pre>&lt;p>It all worked! Make handles building multiple binaries very well—notice how it only built &lt;code>mathlib.c&lt;/code> once, even though it is needed by both binaries. Also, this Makefile compiles both binaries by default (thanks to the &lt;code>all&lt;/code> target), but you can also compile only one binary with &lt;code>make hypot&lt;/code> or &lt;code>make hypot-test&lt;/code>.&lt;/p></description></item></channel></rss>